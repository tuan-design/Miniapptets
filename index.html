<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MiniApp Tổng Quan Chi Tiêu</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --income-color: #10b981;
            --expense-color: #ef4444;
            --transport-color: #f59e0b;
            --income-blue: #3b82f6;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .transaction-income { background-color: #ecfdf5; border-left: 4px solid var(--income-color); }
        .transaction-expense { background-color: #fef2f2; border-left: 4px solid var(--expense-color); }
        .animate-slide { transition: all 0.3s ease-in-out; }
        .animate-scale:hover { transform: scale(1.02); }
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 12px 24px; color: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: none; z-index: 50; }
        .toast-success { background-color: var(--income-color); }
        .toast-error { background-color: var(--expense-color); }
        .modal-bg { backdrop-filter: blur(5px); }
        @media (max-width: 640px) {
            .tab-btn { width: 100%; text-align: left; }
            .tab-nav { flex-direction: column; }
        }
    </style>
</head>
<body class="bg-gray-50 font-['Inter'] min-h-screen">
    <div class="container mx-auto p-4 sm:p-6 max-w-5xl">
        <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-lg shadow-lg p-6 mb-6 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold">Tổng Quan Chi Tiêu</h1>
            <p class="text-sm sm:text-base mt-2">Theo dõi thu chi, quản lý từ khóa dễ dàng</p>
            <p class="text-xs mt-1">©masterhmh</p>
        </header>

        <!-- Tabs -->
        <nav class="tab-nav flex flex-wrap bg-white rounded-lg shadow-md mb-6 overflow-hidden">
            <button class="tab-btn flex-1 px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition" data-tab="tab1">Giao dịch</button>
            <button class="tab-btn flex-1 px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition" data-tab="tab2">Thống kê</button>
            <button class="tab-btn flex-1 px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition" data-tab="tab3">Biểu đồ</button>
            <button class="tab-btn flex-1 px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition" data-tab="tab4">Giới thiệu</button>
            <button class="tab-btn flex-1 px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition" data-tab="tab5">Liệt kê</button>
            <button class="tab-btn flex-1 px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition" data-tab="tab6">Tìm kiếm</button>
            <button class="tab-btn flex-1 px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition" data-tab="tab7">Từ khóa</button>
        </nav>

        <!-- Content Wrapper -->
        <main class="bg-white rounded-lg shadow-md p-4 sm:p-6">
            <!-- Tab 1: Giao dịch trong ngày -->
            <div id="tab1" class="tab-content active">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Giao dịch trong ngày</h2>
                <p class="bg-blue-100 text-blue-800 p-3 rounded-lg mb-4 text-sm">Vui lòng chọn ngày và ấn "Lọc" để xem dữ liệu.</p>
                <div id="errorMessageTab1" class="text-red-600 text-center text-sm mb-4 hidden"></div>
                <div id="successMessageTab1" class="text-green-600 text-center text-sm mb-4 hidden"></div>
                <div id="loadingTab1" class="text-center mb-4 hidden">
                    <div class="inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"></div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 mb-6">
                    <input id="transactionDate" type="date" class="border rounded-lg p-2 text-sm" value="">
                    <button id="fetchTransactionsBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Lọc</button>
                    <button id="addTransactionBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Thêm</button>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6" id="dailySummary">
                    <div class="p-4 bg-green-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-green-800">Tổng thu nhập</h3>
                        <p class="text-xl font-bold text-green-900">0đ</p>
                    </div>
                    <div class="p-4 bg-red-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-red-800">Tổng chi tiêu</h3>
                        <p class="text-xl font-bold text-red-900">0đ</p>
                    </div>
                    <div class="p-4 bg-blue-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-blue-800">Số dư</h3>
                        <p class="text-xl font-bold text-blue-900">0đ</p>
                    </div>
                </div>
                <div id="transactionsContainer" class="space-y-4"></div>
                <div id="pagination" class="mt-6 flex justify-center space-x-2">
                    <button id="prevPage" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm" disabled>Trang trước</button>
                    <span id="pageInfo" class="text-sm font-medium"></span>
                    <button id="nextPage" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">Trang sau</button>
                </div>
            </div>

            <!-- Tab 2: Thống kê -->
            <div id="tab2" class="tab-content">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Thống kê</h2>
                <p class="bg-blue-100 text-blue-800 p-3 rounded-lg mb-4 text-sm">Vui lòng chọn khoảng thời gian và ấn "Lọc" để xem dữ liệu.</p>
                <div id="errorMessageTab2" class="text-red-600 text-center text-sm mb-4 hidden"></div>
                <div id="successMessageTab2" class="text-green-600 text-center text-sm mb-4 hidden"></div>
                <div id="loadingTab2" class="text-center mb-4 hidden">
                    <div class="inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"></div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 mb-6">
                    <input id="startDate" type="date" class="border rounded-lg p-2 text-sm" placeholder="Từ">
                    <input id="endDate" type="date" class="border rounded-lg p-2 text-sm" placeholder="Đến">
                    <button id="fetchDataBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Lọc</button>
                </div>
                <div id="statsContainer" class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                    <div class="p-4 bg-green-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-green-800">Tổng thu nhập</h3>
                        <p class="text-xl font-bold text-green-900">0đ</p>
                    </div>
                    <div class="p-4 bg-red-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-red-800">Tổng chi tiêu</h3>
                        <p class="text-xl font-bold text-red-900">0đ</p>
                    </div>
                    <div class="p-4 bg-blue-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-blue-800">Số dư</h3>
                        <p class="text-xl font-bold text-blue-900">0đ</p>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 class="text-lg font-semibold mb-4">Biểu đồ chi tiêu theo danh mục</h3>
                    <div class="flex justify-center">
                        <div class="w-full max-w-md">
                            <canvas id="myChart" class="w-full h-80"></canvas>
                        </div>
                    </div>
                    <div id="customLegend" class="flex flex-wrap justify-center gap-4 mt-4"></div>
                </div>
            </div>

            <!-- Tab 3: Biểu đồ thu chi theo tháng -->
            <div id="tab3" class="tab-content">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Biểu đồ thu chi theo tháng</h2>
                <p class="bg-blue-100 text-blue-800 p-3 rounded-lg mb-4 text-sm">Vui lòng chọn khoảng thời gian và ấn "Lọc" để xem dữ liệu.</p>
                <div id="errorMessageTab3" class="text-red-600 text-center text-sm mb-4 hidden"></div>
                <div id="successMessageTab3" class="text-green-600 text-center text-sm mb-4 hidden"></div>
                <div id="loadingTab3" class="text-center mb-4 hidden">
                    <div class="inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"></div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 mb-6">
                    <select id="startMonth" class="border rounded-lg p-2 text-sm">
                        <option value="1">Tháng 1</option><option value="2">Tháng 2</option><option value="3">Tháng 3</option>
                        <option value="4">Tháng 4</option><option value="5">Tháng 5</option><option value="6">Tháng 6</option>
                        <option value="7">Tháng 7</option><option value="8">Tháng 8</option><option value="9">Tháng 9</option>
                        <option value="10">Tháng 10</option><option value="11">Tháng 11</option><option value="12">Tháng 12</option>
                    </select>
                    <select id="endMonth" class="border rounded-lg p-2 text-sm">
                        <option value="1">Tháng 1</option><option value="2">Tháng 2</option><option value="3">Tháng 3</option>
                        <option value="4">Tháng 4</option><option value="5">Tháng 5</option><option value="6">Tháng 6</option>
                        <option value="7">Tháng 7</option><option value="8">Tháng 8</option><option value="9">Tháng 9</option>
                        <option value="10">Tháng 10</option><option value="11">Tháng 11</option><option value="12">Tháng 12</option>
                    </select>
                    <button id="fetchMonthlyDataBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Lọc</button>
                </div>
                <div class="chart-container">
                    <canvas id="monthlyChart" class="w-full h-80"></canvas>
                    <div id="monthlyLegend" class="flex flex-wrap gap-2 mt-4"></div>
                </div>
            </div>

            <!-- Tab 4: Giới thiệu -->
            <div id="tab4" class="tab-content">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Giới thiệu</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="p-4 bg-gray-100 rounded-lg shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold">Về MiniApp</h3>
                        <p class="text-sm text-gray-600">MiniApp tài chính trên Telegram giúp bạn theo dõi thu nhập và chi tiêu dễ dàng. Dựa vào dữ liệu trong Google Sheet, nó hiển thị danh sách giao dịch, biểu đồ chi tiêu và thu nhập hàng tháng.</p>
                    </div>
                    <div class="p-4 bg-gray-100 rounded-lg shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold">Ủng hộ</h3>
                        <p class="text-sm text-gray-600">Nếu bạn thấy hữu ích, hãy ủng hộ mình một ly cà phê!</p>
                        <p class="text-sm"><strong>Ngân hàng:</strong> TMCP Sài Gòn – Hà Nội (SHB)</p>
                        <p class="text-sm"><strong>Chủ tài khoản:</strong> Hoang Manh Hung</p>
                        <p class="text-sm"><strong>Số tài khoản:</strong> 6666.6789.9999</p>
                        <a href="https://momo.vn/" target="_blank" class="inline-block bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm mt-2">Ủng hộ qua Momo</a>
                    </div>
                    <div class="p-4 bg-gray-100 rounded-lg shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold">Liên hệ</h3>
                        <p class="text-sm"><strong>Telegram:</strong> <a href="https://t.me/masterhmh" target="_blank" class="text-blue-600 hover:underline">@masterhmh</a></p>
                        <p class="text-sm"><strong>Facebook:</strong> <a href="https://facebook.com/masterhmh" target="_blank" class="text-blue-600 hover:underline">facebook.com/masterhmh</a></p>
                    </div>
                    <div class="p-4 bg-gray-100 rounded-lg shadow-sm animate-slide animate-scale text-center">
                        <h3 class="text-lg font-semibold">Quét mã QR</h3>
                        <img src="https://i.pinimg.com/736x/7c/13/53/7c135389e26cbc6460626deb9e2aa5c6.jpg" alt="QR Code" class="mx-auto w-32 h-32 rounded-lg">
                        <p class="text-sm text-gray-600 mt-2">Quét mã QR để ủng hộ qua Momo</p>
                    </div>
                </div>
            </div>

            <!-- Tab 5: Chi tiêu trong tháng -->
            <div id="tab5" class="tab-content">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Chi tiêu trong tháng</h2>
                <p class="bg-blue-100 text-blue-800 p-3 rounded-lg mb-4 text-sm">Vui lòng chọn tháng và ấn "Lọc" để xem dữ liệu.</p>
                <div id="errorMessageTab5" class="text-red-600 text-center text-sm mb-4 hidden"></div>
                <div id="successMessageTab5" class="text-green-600 text-center text-sm mb-4 hidden"></div>
                <div id="loadingTab5" class="text-center mb-4 hidden">
                    <div class="inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"></div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 mb-6">
                    <select id="expenseMonth" class="border rounded-lg p-2 text-sm">
                        <option value="1">Tháng 1</option><option value="2">Tháng 2</option><option value="3">Tháng 3</option>
                        <option value="4">Tháng 4</option><option value="5">Tháng 5</option><option value="6">Tháng 6</option>
                        <option value="7">Tháng 7</option><option value="8">Tháng 8</option><option value="9">Tháng 9</option>
                        <option value="10">Tháng 10</option><option value="11">Tháng 11</option><option value="12">Tháng 12</option>
                    </select>
                    <button id="fetchMonthlyExpensesBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Lọc</button>
                </div>
                <div id="monthlyExpenseSummary" class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                    <div class="p-4 bg-green-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-green-800">Tổng thu nhập</h3>
                        <p class="text-xl font-bold text-green-900">0đ</p>
                    </div>
                    <div class="p-4 bg-red-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-red-800">Tổng chi tiêu</h3>
                        <p class="text-xl font-bold text-red-900">0đ</p>
                    </div>
                    <div class="p-4 bg-blue-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-blue-800">Số dư</h3>
                        <p class="text-xl font-bold text-blue-900">0đ</p>
                    </div>
                </div>
                <div id="monthlyExpensesContainer" class="space-y-4"></div>
                <div id="paginationMonthly" class="mt-6 flex justify-center space-x-2">
                    <button id="prevPageMonthly" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm" disabled>Trang trước</button>
                    <span id="pageInfoMonthly" class="text-sm font-medium"></span>
                    <button id="nextPageMonthly" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">Trang sau</button>
                </div>
            </div>

            <!-- Tab 6: Tìm kiếm giao dịch -->
            <div id="tab6" class="tab-content">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Tìm kiếm giao dịch</h2>
                <p class="bg-blue-100 text-blue-80
                0 p-3 rounded-lg mb-4 text-sm">Nhập ít nhất một tiêu chí (nội dung, số tiền, hoặc phân loại chi tiết) để tìm kiếm.</p>
                <div id="errorMessageTab6" class="text-red-600 text-center text-sm mb-4 hidden"></div>
                <div id="successMessageTab6" class="text-green-600 text-center text-sm mb-4 hidden"></div>
                <div id="loadingTab6" class="text-center mb-4 hidden">
                    <div class="inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"></div>
                </div>
                <div class="flex flex-col gap-4 mb-6">
                    <div class="flex flex-col sm:flex-row gap-2">
                        <label class="text-sm font-medium w-24">Tháng:</label>
                        <select id="searchMonth" class="border rounded-lg p-2 text-sm flex-1">
                            <option value="">Tất cả</option>
                            <option value="1">Tháng 1</option><option value="2">Tháng 2</option><option value="3">Tháng 3</option>
                            <option value="4">Tháng 4</option><option value="5">Tháng 5</option><option value="6">Tháng 6</option>
                            <option value="7">Tháng 7</option><option value="8">Tháng 8</option><option value="9">Tháng 9</option>
                            <option value="10">Tháng 10</option><option value="11">Tháng 11</option><option value="12">Tháng 12</option>
                        </select>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <label class="text-sm font-medium w-24">Nội dung:</label>
                        <input id="searchContent" type="text" class="border rounded-lg p-2 text-sm flex-1" placeholder="Nhập nội dung">
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <label class="text-sm font-medium w-24">Số tiền:</label>
                        <input id="searchAmount" type="text" class="border rounded-lg p-2 text-sm flex-1" placeholder="Nhập số tiền (VD: 50.000)">
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <label class="text-sm font-medium w-24">Phân loại:</label>
                        <select id="searchCategory" class="border rounded-lg p-2 text-sm flex-1">
                            <option value="">Tất cả</option>
                            <option value="Ăn uống">Ăn uống</option>
                            <option value="Mua sắm">Mua sắm</option>
                            <option value="Di chuyển">Di chuyển</option>
                            <option value="Thu nhập">Thu nhập</option>
                        </select>
                    </div>
                    <button id="searchTransactionsBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Tìm kiếm</button>
                </div>
                <div id="searchResultsContainer" class="space-y-4"></div>
                <div id="paginationSearch" class="mt-6 flex justify-center space-x-2">
                    <button id="prevPageSearch" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm" disabled>Trang trước</button>
                    <span id="pageInfoSearch" class="text-sm font-medium"></span>
                    <button id="nextPageSearch" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">Trang sau</button>
                </div>
            </div>

            <!-- Tab 7: Quản lý từ khóa -->
            <div id="tab7" class="tab-content">
                <h2 class="text-xl sm:text-2xl font-semibold mb-4">Quản lý từ khóa</h2>
                <p class="bg-blue-100 text-blue-800 p-3 rounded-lg mb-4 text-sm">Chọn phân loại chi tiết và nhập từ khóa để thêm hoặc xóa.</p>
                <div id="errorMessageTab7" class="text-red-600 text-center text-sm mb-4 hidden"></div>
                <div id="successMessageTab7" class="text-green-600 text-center text-sm mb-4 hidden"></div>
                <div id="loadingTab7" class="text-center mb-4 hidden">
                    <div class="inline-block h-6 w-6 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"></div>
                </div>
                <div class="flex flex-col gap-4 mb-6">
                    <div class="flex flex-col sm:flex-row gap-2">
                        <label class="text-sm font-medium w-24">Phân loại:</label>
                        <select id="keywordCategory" class="border rounded-lg p-2 text-sm flex-1">
                            <option value="">Chọn phân loại</option>
                            <option value="Ăn uống">Ăn uống</option>
                            <option value="Mua sắm">Mua sắm</option>
                            <option value="Di chuyển">Di chuyển</option>
                            <option value="Thu nhập">Thu nhập</option>
                        </select>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <label class="text-sm font-medium w-24">Từ khóa:</label>
                        <input id="keywordInput" type="text" class="border rounded-lg p-2 text-sm flex-1" placeholder="Nhập từ khóa (VD: đổ dầu, đổ xăng)">
                    </div>
                    <div class="flex gap-2">
                        <button id="addKeywordBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Thêm từ khóa</button>
                        <button id="deleteKeywordBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition text-sm">Xóa từ khóa</button>
                        <button id="fetchKeywordsBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Tải dữ liệu</button>
                    </div>
                </div>
                <div id="keywordsContainer" class="space-y-4"></div>
            </div>

            <!-- Modals -->
            <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 modal-bg flex items-center justify-center hidden z-50">
                <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md animate-slide">
                    <h2 class="text-xl font-semibold mb-4">Chỉnh sửa giao dịch</h2>
                    <div id="editError" class="text-red-600 text-sm mb-4 hidden"></div>
                    <form id="editForm" class="space-y-4">
                        <input id="editTransactionId" type="hidden">
                        <div>
                            <label class="text-sm font-medium">Ngày:</label>
                            <input id="editDate" type="date" class="border rounded-lg p-2 w-full text-sm" required>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Nội dung:</label>
                            <input id="editContent" type="text" class="border rounded-lg p-2 w-full text-sm" placeholder="Nhập nội dung giao dịch" required>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Số tiền:</label>
                            <input id="editAmount" type="text" class="border rounded-lg p-2 w-full text-sm" placeholder="Nhập số tiền (VD: 50.000)" required>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Phân loại:</label>
                            <select id="editType" class="border rounded-lg p-2 w-full text-sm" required>
                                <option value="Thu nhập">Thu nhập</option>
                                <option value="Chi tiêu">Chi tiêu</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Phân loại chi tiết:</label>
                            <select id="editCategory" class="border rounded-lg p-2 w-full text-sm" required>
                                <option value="Ăn uống">Ăn uống</option>
                                <option value="Mua sắm">Mua sắm</option>
                                <option value="Di chuyển">Di chuyển</option>
                                <option value="Thu nhập">Thu nhập</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Ghi chú:</label>
                            <textarea id="editNote" class="border rounded-lg p-2 w-full text-sm" placeholder="Nhập ghi chú (tùy chọn)"></textarea>
                        </div>
                        <div class="flex justify-end gap-2">
                            <button type="button" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition text-sm" onclick="closeEditForm()">Hủy</button>
                            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Lưu</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="addModal" class="fixed inset-0 bg-black bg-opacity-50 modal-bg flex items-center justify-center hidden z-50">
                <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md animate-slide">
                    <h2 class="text-xl font-semibold mb-4">Thêm giao dịch mới</h2>
                    <div id="addError" class="text-red-600 text-sm mb-4 hidden"></div>
                    <form id="addForm" class="space-y-4">
                        <div>
                            <label class="text-sm font-medium">Ngày:</label>
                            <input id="addDate" type="date" class="border rounded-lg p-2 w-full text-sm" required>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Nội dung:</label>
                            <input id="addContent" type="text" class="border rounded-lg p-2 w-full text-sm" placeholder="Nhập nội dung giao dịch" required>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Số tiền:</label>
                            <input id="addAmount" type="text" class="border rounded-lg p-2 w-full text-sm" placeholder="Nhập số tiền (VD: 50.000)" required>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Phân loại:</label>
                            <select id="addType" class="border rounded-lg p-2 w-full text-sm" required>
                                <option value="Thu nhập">Thu nhập</option>
                                <option value="Chi tiêu">Chi tiêu</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Phân loại chi tiết:</label>
                            <select id="addCategory" class="border rounded-lg p-2 w-full text-sm" required>
                                <option value="Ăn uống">Ăn uống</option>
                                <option value="Mua sắm">Mua sắm</option>
                                <option value="Di chuyển">Di chuyển</option>
                                <option value="Thu nhập">Thu nhập</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Ghi chú:</label>
                            <textarea id="addNote" class="border rounded-lg p-2 w-full text-sm" placeholder="Nhập ghi chú (tùy chọn)"></textarea>
                        </div>
                        <div class="flex justify-end gap-2">
                            <button type="button" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition text-sm" onclick="closeAddForm()">Hủy</button>
                            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">Lưu</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="confirmDeleteModal" class="fixed inset-0 bg-black bg-opacity-50 modal-bg flex items-center justify-center hidden z-50">
                <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md animate-slide">
                    <h2 class="text-xl font-semibold mb-4">Xác nhận xóa</h2>
                    <p class="text-sm text-gray-600 mb-4">Bạn có chắc chắn muốn xóa giao dịch này? Hành động này không thể hoàn tác.</p>
                    <div class="flex justify-end gap-2">
                        <button class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition text-sm" onclick="closeConfirmDeleteModal()">Hủy</button>
                        <button id="confirmDeleteBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition text-sm">Xóa</button>
                    </div>
                </div>
            </div>

            <!-- Toast Notification -->
            <div id="toast" class="toast"></div>
        </main>
    </div>

    <script>
        // Dữ liệu nhúng trực tiếp
        let transactions = [
            { id: 1, date: '2025-07-24', amount: 500000, type: 'Thu nhập', content: 'Lương', category: 'Thu nhập', note: '' },
            { id: 2, date: '2025-07-24', amount: 100000, type: 'Chi tiêu', content: 'Ăn trưa', category: 'Ăn uống', note: '' },
            { id: 3, date: '2025-06-15', amount: 200000, type: 'Chi tiêu', content: 'Mua áo', category: 'Mua sắm', note: '' },
        ];
        let keywords = [
            { keyword: 'lương', category: 'Thu nhập' },
            { keyword: 'ăn', category: 'Ăn uống' },
            { keyword: 'mua', category: 'Mua sắm' },
        ];
        let categories = ['Ăn uống', 'Mua sắm', 'Di chuyển', 'Thu nhập'];
        let categoryColors = {
            'Ăn uống': 'rgba(16, 185, 129, 0.6)',
            'Mua sắm': 'rgba(239, 68, 68, 0.6)',
            'Di chuyển': 'rgba(245, 158, 11, 0.6)',
            'Thu nhập': 'rgba(59, 130, 246, 0.6)'
        };
        let currentPage = { tab1: 1, tab5: 1, tab6: 1 };
        let itemsPerPage = 5;
        let chartInstance = null;
        let monthlyChartInstance = null;
        let deleteTransactionId = null;

        // Khởi tạo ngày hiện tại
        document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('addDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('startDate').value = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
        document.getElementById('endDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('expenseMonth').value = new Date().getMonth() + 1;

        // Chuyển đổi tab
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                document.getElementById(btn.dataset.tab).classList.add('active');
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('bg-blue-50', 'text-blue-600'));
                btn.classList.add('bg-blue-50', 'text-blue-600');
                if (btn.dataset.tab === 'tab1') renderDailyTransactions();
                if (btn.dataset.tab === 'tab2') renderStats();
                if (btn.dataset.tab === 'tab3') renderMonthlyChart();
                if (btn.dataset.tab === 'tab5') renderMonthlyExpenses();
                if (btn.dataset.tab === 'tab6') searchTransactions();
                if (btn.dataset.tab === 'tab7') renderKeywords();
            });
        });

        // Hiển thị thông báo
        function showToast(message, type) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast toast-${type} animate-slide`;
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 3000);
        }

        // Modal controls
        function openEditForm(id) {
            const transaction = transactions.find(t => t.id === id);
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editTransactionId').value = transaction.id;
            document.getElementById('editDate').value = transaction.date;
            document.getElementById('editContent').value = transaction.content;
            document.getElementById('editAmount').value = transaction.amount.toLocaleString();
            document.getElementById('editType').value = transaction.type;
            document.getElementById('editCategory').value = transaction.category;
            document.getElementById('editNote').value = transaction.note;
        }

        function closeEditForm() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editError').classList.add('hidden');
        }

        function openAddForm() {
            document.getElementById('addModal').classList.remove('hidden');
            document.getElementById('addForm').reset();
            document.getElementById('addDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('addError').classList.add('hidden');
        }

        function closeAddForm() {
            document.getElementById('addModal').classList.add('hidden');
            document.getElementById('addError').classList.add('hidden');
        }

        function openConfirmDeleteModal(id) {
            deleteTransactionId = id;
            document.getElementById('confirmDeleteModal').classList.remove('hidden');
        }

        function closeConfirmDeleteModal() {
            document.getElementById('confirmDeleteModal').classList.add('hidden');
            deleteTransactionId = null;
        }

        // Form submissions
        document.getElementById('editForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const id = parseInt(document.getElementById('editTransactionId').value);
            const date = document.getElementById('editDate').value;
            const content = document.getElementById('editContent').value;
            const amount = parseFloat(document.getElementById('editAmount').value.replace(/\D/g, ''));
            const type = document.getElementById('editType').value;
            const category = document.getElementById('editCategory').value;
            const note = document.getElementById('editNote').value;

            if (!date || !content || isNaN(amount) || !category) {
                document.getElementById('editError').textContent = 'Vui lòng điền đầy đủ thông tin';
                document.getElementById('editError').classList.remove('hidden');
                return;
            }

            const transaction = transactions.find(t => t.id === id);
            transaction.date = date;
            transaction.content = content;
            transaction.amount = amount;
            transaction.type = type;
            transaction.category = category;
            transaction.note = note;

            showToast('Cập nhật giao dịch thành công', 'success');
            closeEditForm();
            renderDailyTransactions();
            renderStats();
            renderMonthlyChart();
            renderMonthlyExpenses();
        });

        document.getElementById('addForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const date = document.getElementById('addDate').value;
            const content = document.getElementById('addContent').value;
            const amount = parseFloat(document.getElementById('addAmount').value.replace(/\D/g, ''));
            const type = document.getElementById('addType').value;
            const category = document.getElementById('addCategory').value;
            const note = document.getElementById('addNote').value;

            if (!date || !content || isNaN(amount) || !category) {
                document.getElementById('addError').textContent = 'Vui lòng điền đầy đủ thông tin';
                document.getElementById('addError').classList.add('hidden');
                return;
            }

            const newId = transactions.length ? Math.max(...transactions.map(t => t.id)) + 1 : 1;
            transactions.push({ id: newId, date, amount, type, content, category, note });
            showToast('Thêm giao dịch thành công', 'success');
            closeAddForm();
            renderDailyTransactions();
            renderStats();
            renderMonthlyChart();
            renderMonthlyExpenses();
        });

        document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
            transactions = transactions.filter(t => t.id !== deleteTransactionId);
            showToast('Xóa giao dịch thành công', 'success');
            closeConfirmDeleteModal();
            renderDailyTransactions();
            renderStats();
            renderMonthlyChart();
            renderMonthlyExpenses();
        });

        // Phân trang
        function renderPagination(containerId, data, page, renderFunction) {
            const container = document.getElementById(containerId);
            container.querySelector('span').textContent = `Trang ${page} / ${Math.ceil(data.length / itemsPerPage)}`;
            container.querySelector('#prevPage' + (containerId === 'pagination' ? '' : containerId.replace('pagination', ''))).disabled = page === 1;
            container.querySelector('#nextPage' + (containerId === 'pagination' ? '' : containerId.replace('pagination', ''))).disabled = page === Math.ceil(data.length / itemsPerPage);
        }

        // Tab 1: Giao dịch trong ngày
        document.getElementById('fetchTransactionsBtn').addEventListener('click', () => renderDailyTransactions());
        document.getElementById('addTransactionBtn').addEventListener('click', openAddForm);
        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage.tab1 > 1) {
                currentPage.tab1--;
                renderDailyTransactions();
            }
        });
        document.getElementById('nextPage').addEventListener('click', () => {
            const date = document.getElementById('transactionDate').value;
            const filtered = transactions.filter(t => t.date === date);
            if (currentPage.tab1 < Math.ceil(filtered.length / itemsPerPage)) {
                currentPage.tab1++;
                renderDailyTransactions();
            }
        });

        function renderDailyTransactions() {
            const date = document.getElementById('transactionDate').value;
            const filtered = transactions.filter(t => t.date === date);
            const start = (currentPage.tab1 - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginated = filtered.slice(start, end);

            document.getElementById('loadingTab1').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loadingTab1').classList.add('hidden');
                document.getElementById('transactionsContainer').innerHTML = paginated.map(t => `
                    <div class="p-4 rounded-lg shadow-sm ${t.type === 'Thu nhập' ? 'transaction-income' : 'transaction-expense'} animate-slide animate-scale">
                        <p class="text-sm font-medium"><strong>Nội dung:</strong> ${t.content}</p>
                        <p class="text-sm"><strong>Số tiền:</strong> ${t.amount.toLocaleString()}đ</p>
                        <p class="text-sm"><strong>Danh mục:</strong> ${t.category}</p>
                        ${t.note ? `<p class="text-sm"><strong>Ghi chú:</strong> ${t.note}</p>` : ''}
                        <div class="mt-2 flex gap-2">
                            <button class="bg-yellow-500 text-white px-3 py-1 rounded-lg hover:bg-yellow-600 transition text-sm" onclick="openEditForm(${t.id})">Sửa</button>
                            <button class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition text-sm" onclick="openConfirmDeleteModal(${t.id})">Xóa</button>
                        </div>
                    </div>
                `).join('');
                const income = filtered.filter(t => t.type === 'Thu nhập').reduce((sum, t) => sum + t.amount, 0);
                const expense = filtered.filter(t => t.type === 'Chi tiêu').reduce((sum, t) => sum + t.amount, 0);
                document.getElementById('dailySummary').innerHTML = `
                    <div class="p-4 bg-green-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-green-800">Tổng thu nhập</h3>
                        <p class="text-xl font-bold text-green-900">${income.toLocaleString()}đ</p>
                    </div>
                    <div class="p-4 bg-red-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-red-800">Tổng chi tiêu</h3>
                        <p class="text-xl font-bold text-red-900">${expense.toLocaleString()}đ</p>
                    </div>
                    <div class="p-4 bg-blue-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-blue-800">Số dư</h3>
                        <p class="text-xl font-bold text-blue-900">${(income - expense).toLocaleString()}đ</p>
                    </div>
                `;
                renderPagination('pagination', filtered, currentPage.tab1, renderDailyTransactions);
            }, 500);
        }

        // Tab 2: Thống kê
        document.getElementById('fetchDataBtn').addEventListener('click', () => renderStats());
        function renderStats() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const filtered = transactions.filter(t => t.date >= startDate && t.date <= endDate);
            document.getElementById('loadingTab2').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loadingTab2').classList.add('hidden');
                const income = filtered.filter(t => t.type === 'Thu nhập').reduce((sum, t) => sum + t.amount, 0);
                const expense = filtered.filter(t => t.type === 'Chi tiêu').reduce((sum, t) => sum + t.amount, 0);
                document.getElementById('statsContainer').innerHTML = `
                    <div class="p-4 bg-green-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-green-800">Tổng thu nhập</h3>
                        <p class="text-xl font-bold text-green-900">${income.toLocaleString()}đ</p>
                    </div>
                    <div class="p-4 bg-red-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-red-800">Tổng chi tiêu</h3>
                        <p class="text-xl font-bold text-red-900">${expense.toLocaleString()}đ</p>
                    </div>
                    <div class="p-4 bg-blue-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-blue-800">Số dư</h3>
                        <p class="text-xl font-bold text-blue-900">${(income - expense).toLocaleString()}đ</p>
                    </div>
                `;
                const categoryData = categories.map(cat => ({
                    category: cat,
                    amount: filtered.filter(t => t.category === cat && t.type === 'Chi tiêu').reduce((sum, t) => sum + t.amount, 0)
                })).filter(d => d.amount > 0); // Loại bỏ danh mục có số tiền = 0
                if (chartInstance) chartInstance.destroy();
                chartInstance = new Chart(document.getElementById('myChart'), {
                    type: 'pie',
                    data: {
                        labels: categoryData.map(d => d.category),
                        datasets: [{
                            data: categoryData.map(d => d.amount),
                            backgroundColor: categoryData.map(d => categoryColors[d.category]),
                            borderWidth: 1,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: '#1f2937',
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        let value = context.raw || 0;
                                        return `${label}: ${value.toLocaleString()}đ`;
                                    }
                                }
                            }
                        }
                    }
                });
                document.getElementById('customLegend').innerHTML = categoryData.map(cat => `
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded" style="background-color: ${categoryColors[cat.category]}"></div>
                        <span class="text-sm">${cat.category} (${cat.amount.toLocaleString()}đ)</span>
                    </div>
                `).join('');
            }, 500);
        }

        // Tab 3: Biểu đồ thu chi theo tháng
        document.getElementById('fetchMonthlyDataBtn').addEventListener('click', () => renderMonthlyChart());
        function renderMonthlyChart() {
            const startMonth = parseInt(document.getElementById('startMonth').value);
            const endMonth = parseInt(document.getElementById('endMonth').value);
            if (startMonth > endMonth) {
                showToast('Tháng bắt đầu phải nhỏ hơn hoặc bằng tháng kết thúc', 'error');
                return;
            }
            document.getElementById('loadingTab3').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loadingTab3').classList.add('hidden');
                const monthlyData = [];
                for (let i = startMonth - 1; i < endMonth; i++) {
                    const income = transactions.filter(t => t.type === 'Thu nhập' && new Date(t.date).getMonth() === i).reduce((sum, t) => sum + t.amount, 0);
                    const expense = transactions.filter(t => t.type === 'Chi tiêu' && new Date(t.date).getMonth() === i).reduce((sum, t) => sum + t.amount, 0);
                    monthlyData.push({ month: `Tháng ${i + 1}`, income, expense });
                }
                if (monthlyChartInstance) monthlyChartInstance.destroy();
                monthlyChartInstance = new Chart(document.getElementById('monthlyChart'), {
                    type: 'bar',
                    data: {
                        labels: monthlyData.map(d => d.month),
                        datasets: [
                            { label: 'Thu nhập', data: monthlyData.map(d => d.income), backgroundColor: 'rgba(16, 185, 129, 0.6)', borderRadius: 4 },
                            { label: 'Chi tiêu', data: monthlyData.map(d => d.expense), backgroundColor: 'rgba(239, 68, 68, 0.6)', borderRadius: 4 }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { position: 'top' }, tooltip: { backgroundColor: '#1f2937' } },
                        scales: { y: { beginAtZero: true, grid: { color: '#e5e7eb' } }, x: { grid: { display: false } } }
                    }
                });
                document.getElementById('monthlyLegend').innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-green-600 rounded"></div>
                        <span class="text-sm">Thu nhập</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-red-600 rounded"></div>
                        <span class="text-sm">Chi tiêu</span>
                    </div>
                `;
            }, 500);
        }

        // Tab 5: Chi tiêu trong tháng
        document.getElementById('fetchMonthlyExpensesBtn').addEventListener('click', () => renderMonthlyExpenses());
        document.getElementById('prevPageMonthly').addEventListener('click', () => {
            if (currentPage.tab5 > 1) {
                currentPage.tab5--;
                renderMonthlyExpenses();
            }
        });
        document.getElementById('nextPageMonthly').addEventListener('click', () => {
            const month = parseInt(document.getElementById('expenseMonth').value);
            const filtered = transactions.filter(t => new Date(t.date).getMonth() === month - 1);
            if (currentPage.tab5 < Math.ceil(filtered.length / itemsPerPage)) {
                currentPage.tab5++;
                renderMonthlyExpenses();
            }
        });

        function renderMonthlyExpenses() {
            const month = parseInt(document.getElementById('expenseMonth').value);
            const filtered = transactions.filter(t => new Date(t.date).getMonth() === month - 1);
            const start = (currentPage.tab5 - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginated = filtered.slice(start, end);

            document.getElementById('loadingTab5').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loadingTab5').classList.add('hidden');
                document.getElementById('monthlyExpensesContainer').innerHTML = paginated.map(t => `
                    <div class="p-4 rounded-lg shadow-sm ${t.type === 'Thu nhập' ? 'transaction-income' : 'transaction-expense'} animate-slide animate-scale">
                        <p class="text-sm font-medium"><strong>Nội dung:</strong> ${t.content}</p>
                        <p class="text-sm"><strong>Số tiền:</strong> ${t.amount.toLocaleString()}đ</p>
                        <p class="text-sm"><strong>Danh mục:</strong> ${t.category}</p>
                        <p class="text-sm"><strong>Ngày:</strong> ${t.date}</p>
                        ${t.note ? `<p class="text-sm"><strong>Ghi chú:</strong> ${t.note}</p>` : ''}
                        <div class="mt-2 flex gap-2">
                            <button class="bg-yellow-500 text-white px-3 py-1 rounded-lg hover:bg-yellow-600 transition text-sm" onclick="openEditForm(${t.id})">Sửa</button>
                            <button class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition text-sm" onclick="openConfirmDeleteModal(${t.id})">Xóa</button>
                        </div>
                    </div>
                `).join('');
                const income = filtered.filter(t => t.type === 'Thu nhập').reduce((sum, t) => sum + t.amount, 0);
                const expense = filtered.filter(t => t.type === 'Chi tiêu').reduce((sum, t) => sum + t.amount, 0);
                document.getElementById('monthlyExpenseSummary').innerHTML = `
                    <div class="p-4 bg-green-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-green-800">Tổng thu nhập</h3>
                        <p class="text-xl font-bold text-green-900">${income.toLocaleString()}đ</p>
                    </div>
                    <div class="p-4 bg-red-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-red-800">Tổng chi tiêu</h3>
                        <p class="text-xl font-bold text-red-900">${expense.toLocaleString()}đ</p>
                    </div>
                    <div class="p-4 bg-blue-100 rounded-lg text-center shadow-sm animate-slide animate-scale">
                        <h3 class="text-lg font-semibold text-blue-800">Số dư</h3>
                        <p class="text-xl font-bold text-blue-900">${(income - expense).toLocaleString()}đ</p>
                    </div>
                `;
                renderPagination('paginationMonthly', filtered, currentPage.tab5, renderMonthlyExpenses);
            }, 500);
        }

        // Tab 6: Tìm kiếm giao dịch
        document.getElementById('searchTransactionsBtn').addEventListener('click', () => {
            currentPage.tab6 = 1;
            searchTransactions();
        });
        document.getElementById('prevPageSearch').addEventListener('click', () => {
            if (currentPage.tab6 > 1) {
                currentPage.tab6--;
                searchTransactions();
            }
        });
        document.getElementById('nextPageSearch').addEventListener('click', () => {
            const filtered = getSearchResults();
            if (currentPage.tab6 < Math.ceil(filtered.length / itemsPerPage)) {
                currentPage.tab6++;
                searchTransactions();
            }
        });

        function getSearchResults() {
            const month = document.getElementById('searchMonth').value;
            const content = document.getElementById('searchContent').value.toLowerCase();
            const amount = document.getElementById('searchAmount').value.replace(/\D/g, '');
            const category = document.getElementById('searchCategory').value;

            return transactions.filter(t => {
                const matchMonth = !month || new Date(t.date).getMonth() === parseInt(month) - 1;
                const matchContent = !content || t.content.toLowerCase().includes(content) || keywords.some(k => k.keyword.toLowerCase() === content && k.category === t.category);
                const matchAmount = !amount || t.amount.toString().includes(amount);
                const matchCategory = !category || t.category === category;
                return matchMonth && matchContent && matchAmount && matchCategory;
            });
        }

        function searchTransactions() {
            const filtered = getSearchResults();
            const start = (currentPage.tab6 - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginated = filtered.slice(start, end);

            document.getElementById('loadingTab6').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loadingTab6').classList.add('hidden');
                if (filtered.length === 0) {
                    document.getElementById('errorMessageTab6').textContent = 'Không tìm thấy giao dịch nào';
                    document.getElementById('errorMessageTab6').classList.remove('hidden');
                    document.getElementById('searchResultsContainer').innerHTML = '';
                    renderPagination('paginationSearch', filtered, currentPage.tab6, searchTransactions);
                    return;
                }
                document.getElementById('errorMessageTab6').classList.add('hidden');
                document.getElementById('searchResultsContainer').innerHTML = paginated.map(t => `
                    <div class="p-4 rounded-lg shadow-sm ${t.type === 'Thu nhập' ? 'transaction-income' : 'transaction-expense'} animate-slide animate-scale">
                        <p class="text-sm font-medium"><strong>Nội dung:</strong> ${t.content}</p>
                        <p class="text-sm"><strong>Số tiền:</strong> ${t.amount.toLocaleString()}đ</p>
                        <p class="text-sm"><strong>Danh mục:</strong> ${t.category}</p>
                        <p class="text-sm"><strong>Ngày:</strong> ${t.date}</p>
                        ${t.note ? `<p class="text-sm"><strong>Ghi chú:</strong> ${t.note}</p>` : ''}
                        <div class="mt-2 flex gap-2">
                            <button class="bg-yellow-500 text-white px-3 py-1 rounded-lg hover:bg-yellow-600 transition text-sm" onclick="openEditForm(${t.id})">Sửa</button>
                            <button class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition text-sm" onclick="openConfirmDeleteModal(${t.id})">Xóa</button>
                        </div>
                    </div>
                `).join('');
                renderPagination('paginationSearch', filtered, currentPage.tab6, searchTransactions);
            }, 500);
        }

        // Tab 7: Quản lý từ khóa
        document.getElementById('addKeywordBtn').addEventListener('click', () => {
            const keyword = document.getElementById('keywordInput').value;
            const category = document.getElementById('keywordCategory').value;
            if (!keyword || !category) {
                showToast('Vui lòng nhập từ khóa và chọn phân loại', 'error');
                return;
            }
            document.getElementById('loadingTab7').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loadingTab7').classList.add('hidden');
                keywords.push({ keyword, category });
                document.getElementById('keywordInput').value = '';
                showToast('Thêm từ khóa thành công', 'success');
                renderKeywords();
            }, 500);
        });

        document.getElementById('deleteKeywordBtn').addEventListener('click', () => {
            const keyword = document.getElementById('keywordInput').value;
            if (!keyword) {
                showToast('Vui lòng nhập từ khóa để xóa', 'error');
                return;
            }
            document.getElementById('loadingTab7').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loadingTab7').classList.add('hidden');
                const index = keywords.findIndex(k => k.keyword === keyword);
                if (index === -1) {
                    showToast('Từ khóa không tồn tại', 'error');
                    return;
                }
                keywords.splice(index, 1);
                document.getElementById('keywordInput').value = '';
                showToast('Xóa từ khóa thành công', 'success');
                renderKeywords();
            }, 500);
        });

        document.getElementById('fetchKeywordsBtn').addEventListener('click', () => {
            document.getElementById('loadingTab7').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loadingTab7').classList.add('hidden');
                renderKeywords();
            }, 500);
        });

        function renderKeywords() {
            document.getElementById('keywordsContainer').innerHTML = keywords.map(k => `
                <div class="p-4 bg-gray-100 rounded-lg flex justify-between items-center shadow-sm animate-slide animate-scale">
                    <div>
                        <p class="text-sm font-medium"><strong>Từ khóa:</strong> ${k.keyword}</p>
                        <p class="text-sm"><strong>Danh mục:</strong> ${k.category}</p>
                    </div>
                    <button class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition text-sm" onclick="deleteKeyword('${k.keyword}')">Xóa</button>
                </div>
            `).join('');
        }

        function deleteKeyword(keyword) {
            keywords = keywords.filter(k => k.keyword !== keyword);
            showToast('Xóa từ khóa thành công', 'success');
            renderKeywords();
        }

        // Khởi tạo
        renderDailyTransactions();
    </script>
</body>
</html>
